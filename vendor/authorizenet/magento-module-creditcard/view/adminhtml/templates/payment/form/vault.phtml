<?php

/** @var Magento\Vault\Block\Form $block */

use AuthorizeNet\CreditCard\Gateway\Config\Config;

$code = $block->escapeHtml($block->getMethodCode());
$cvvRequired = $block->getMethod()->getConfigData(Config::KEY_ADMIN_REQUIRE_CVV);
?>
<fieldset data-mage-init='{
        "Magento_Vault/js/vault": {
            "code": "<?= /* @noEscape */ $code ?>",
            "fieldset": "payment_form_<?= /* @noEscape */ $code ?>"
        }
    }' class="admin__fieldset payment-method" id="payment_form_<?= /* @noEscape */ $code ?>" style="display: none;">

    <input type="hidden" name="payment[public_hash]" id="<?= /* @noEscape */ $code ?>_public_hash" value="" />

    <?= $block->getChildHtml() ?>

    <?php if ($cvvRequired) : ?>
        <div class="field-number required admin__field _required">
            <label class="admin__field-label" for="<?= /* @noEscape */ $code ?>_vault_cvv">
                <span><?= $block->escapeHtml(__('Card Verification Number')) ?></span>
            </label>
            <div class="admin__field-control">
                <input type="text" title="<?= $block->escapeHtml(__('Card Verification Number')) ?>"
                       class="required-entry validate-number admin__control-cvn admin__control-text"
                       id="<?= /* @noEscape */ $code ?>_vault_cvv"
                       name="payment[vault_cvv]" value="" autocomplete="off" style="width: 6rem;" />
            </div>
        </div>
    <?php endif; ?>
</fieldset>

<script>
    require(["Magento_Sales/order/create/form"], function () {
        window.order.addExcludedPaymentMethod('<?= /* @noEscape */ $code ?>');
    });
</script>
